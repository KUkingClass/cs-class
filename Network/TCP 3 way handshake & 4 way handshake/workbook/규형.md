# 🤝 TCP Handshake 워크북

## Q1. TCP Handshake과정에서, 연결을 성립할 때와 해제할 때 각각 몇번 handshake가 일어날까요?
-> 연결할때는 3번, 해제할때는 4번 일어난다.

## Q2. 그렇다면 두 단계가 왜 차이가 날까요?
-> 연결 시 SYN(클라이언트), SYN ACK(서버), ACK(클라이언트) 세그먼트가 전송되므로 3 way handshake가 된다. \
해제 시 FIN(클라이언트), FIN ACK(서버), FIN(서버), FIN ACK(클라이언트) 세그먼트가 전송되므로 4 way handshake가 된다.
  - 연결을 성립할 때와 해제할 때, 해제를 요청받은 쪽에서 왜 성립할 때처럼 SYN, ACK 를 같이 보내는 게 아니고, FIN을 보낸 후에 ACK를 보낼까요? \
    -> (ACK가 먼저 나가고 FIN이 나가는거 아닌가용?) 서버가 FIN을 받으면 잘 수신했다는 의미로 ACK를 보낸다. 이때 보내야하는 데이터를 모두 보낸 후 연결을 종료할 준비가 됐을 때 FIN을 보낸다.

## Q3. 성립할 때 & 해제할 때 Handshake 과정을 간단하게 설명해보세요.
**성립** 
1. 클라이언트가 서버로 SYN 보냄
2. 서버는 연결을 위한 변수 및 환경 세팅 후 ACK에 SYN + 1을 할당해 SYN ACK 보냄
3. 클라이언트는 서버의 SYN ACK를 받고 연결을 위한 변수 및 환경 세팅 후 ACK 보냄

**해제**
1. 클라이언트가 서버로 FIN 보냄
2. 서버는 잘 받았다는 의미로 ACK 보냄
3. 보내야하는 데이터를 모두 보낸 이후 연결 종료 준비가 완료된 서버가 클라이언트에게 FIN 보냄
4. 클라이언트는 서버 종료를 확인했다는 의미로 ACK 보냄

## Q4. SYN 패킷을 보낼 때 최초의 sequence number를 ISN(Initial sequence number)라고 합니다. ISN은 랜덤으로 선택된다고 했는데요, 랜덤으로 선택하는 이유가 뭘까요?
IP 주소 스푸핑, 세션 하이재킹 등의 해킹 공격을 막기 위해서 랜덤한 시퀀스 넘버를 사용한다.

## Q5. Dos 공격 방법 중에, 3-way handshake 과정을 이용한 공격 방식이 있습니다. 랜덤 IP의 클라이언트가 계속해서 3-way handshake의 첫번째  SYN 패킷을 보내는 공격인데요. 이게 왜 문제가 되는 걸까요?
클라이언트가 SYN을 보내면 서버는 연결을 위해 변수 할당을 위해 메모리를 사용한다. 실제로 연결하지 않을 공격자들의 수많은 SYN 패킷이 계속해서 들어오면 서버 컴퓨터가 심각한 부하를 받게된다. 
- 공격 이름을 맞춰보세요~
  - SYN Flooding 공격